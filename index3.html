<!DOCTYPE>
<!Designed by Amin Mirkouei>
  <html class="ie ie7 no-js" lang="en-US">
  <html class="ie ie8 no-js" lang="en-US">
  <html class="no-js" lang="en-US">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IDEAL Research Group @ Uni. of Idaho</title>
    <!-- TODO: Fix the CSS -->
    <link rel="stylesheet" href="css/lca.css"> 
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
    <link href="twoColLiqLtHdr.css" rel="stylesheet" type="text/css" />
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-101336701-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery-3.5.1.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery.csv-0.71.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery.dataTables.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.select.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>
    
    <script src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.buttons.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>
    
    <script src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.editor.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <!-- The library for the pdf creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.1.1/jspdf.umd.min.js" type="module"></script>
    <!-- <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jspdf.umd.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script> -->

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/html2canvas.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="js/html2csv.js" type="text/javascript"></script>

    <!-- Move the logic at the end of this file to lca.js -->
    <script src="js/lca_economic.js" type="text/javascript"></script>

  </head>

  <body>
    <div class="container">
      <div class="header">
        <div>
          <div style="height: 35px; background-color: #FFC300  ; border-bottom: #000000; margin-bottom: 10px;">
          </div>
          <h2 class="text">
            <a href="https://www.uidaho.edu/idaho-falls">
              <img src="UI.JPG" class="panel" style="width: 271px; height: 90px; float: left;" /></a></h2>
          <h2 class="panel" align="center">Innovative Design and Manufacturing Laboratory<img src="ideal.JPG"
              class="panel" style="width: 271px; height: 90px; float:right;" /></a></h2>
          <h2 class="panel" align="center">PI: Dr. Amin Mirkouei</a></h2>
        </div>
        <div style="height: 17px; background-color: #808080; border-bottom: #b39700; margin-bottom: 30px;">
        </div>
        <!-- end .header -->
      </div>

      <div class="sidebar1">
        <nav class="menu">
          <p><a href="index.html">Home</a></p>
          <p><a href="lca.html">LCA</a></p>
          <p><a href="economic.html">Economic Assessment</a></p>
          <p><a href="environmental.html">Envorinmental Assessment</a></p>
          <p><a href="social.html">Social Assessment</a></p>
        </nav>
        <!-- end .sidebar1 -->
      </div>

      <div class="content" style="width: 70%">
        <!-- LCA -->
        <article id="Life Cycle Assessment" class="panel">
          <header>
            <h2>Life Cycle Assessment (LCA) v0.01 - Economic</h2>

            <p align="justify" class="panel">An open-source software for LCA and sustainability assessment.</p>
            <p>&nbsp;</p>
            <h3>Getting started:</h3>
            <li style="font-size:12pt"> Manuals, case studies, and databases are available <b><a
                  href="manual.html">here.</b></a></li>

            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="infoHeader">Name of the project, Name and Email:</h3>

            <table>
              <tr>
                <td><input id="projectName" type="text" name="projectName" placeholder="Name of the project" /></td>
              </tr>
              <tr>
                <td><input id="name" type="text" name="name" placeholder="Name" /></td>
                <td><input id="email" type="email" name="email" placeholder="Email" /></td>
              </tr>
            </table>


            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="scopeHeader">Phase 1. Goal and scope definition:</h3>
            <li style="font-size:12pt"> <b>Define your goal, scope, system boundary, functional unit, and case study
                assumptions down here:</b></li>

            <textarea id="phase1Text" name="phase1Text" rows="4" cols="50">

            </textarea>

            <!-- <li style="font-size:12pt"> <b>Example:</b> LCA performed herein evaluates GWP for the manure to valueadded
              products life cycle. GHG emission factors are used to calculate the
              GWP (in kg CO2 equivalent) with the key factors being 28 kg CO2 eq./kg
              CH4 and 265 kg CO2 eq./kg N2O, which are acquired from the Intergovernmental
              Panel on Climate Change for a 100-year time horizon. The <b>scope</b> of this study includes four distinct
              stages that can be
              categorized into two processes: (i) upstream processes, including raw material (cattle manure) collection,
              and (ii) midstream processes,
              involving on-site pretreatment (dewatering and size reduction), on-site converting manure to intermediate
              products (biochar, bio-oil, and pyrolysis
              gas), on-site reusing intermediate products (e.g., bio-oil and pyrolysis gas) for pretreatment purposes
              (i.e., heat and electricity), and
              biochar distribution. This <b>scope considers a cradle-to-gate system boundary</b>. The <b>functional
                unit</b> in this study is one kilogram of
              biochar, using the identified scope.</li> -->

            <h3>-----------------------------------</h3>
            <h3 id="phase2Header">Phase 2. Life cycle inventory (LCI):</h3>
            <!-- <li style="font-size:12pt"> Creating a database</li> -->

            <input type="radio" id="createDatabase" name="databaseMethod" value="createDatabase">
            <label for="createDatabase"><i>Creating a database</i></label>

            <div id="customTableDivCup" style="display: none;">
              <table id="customTableCup" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Raw Material Mass</th>
                    <th>Collection/Transportation Cost</th>                    
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        C Upstream (Cup)
                      </td>
                      <td><input id="rawMass" type="text" name="rawMass" placeholder="Raw Material Mass" class="rawMass"/></td>
                      <td><input id="transportationCost" type="text" name="transportationCost" placeholder="Collection/Transportation Cost" class="transportationCost" /></td>                      
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonCup" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1Cup" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountCup"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabaseCup" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>


            <div id="customTableDivCMid" style="display: none;">
              <table id="customTableCMid" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Raw Material Mass</th>
                    <th>Production Cost</th>                   
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        C Midstream (Cmid)
                      </td>
                      <td><input id="rawMass" type="text" name="rawMass" placeholder="Raw Material Mass" class="rawMass"/></td>
                      <td><input id="productionCost" type="text" name="productionCost" placeholder="Production Cost" class="productionCost" /></td>                     
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonCMid" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1CMid" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountCMid"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabaseCMid" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>

            <div id="customTableDivCDown" style="display: none;">
              <table id="customTableCDown" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Final Product Mass</th>
                    <th>Distribution Cost</th>                  
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        C Downstream (Cdown)
                      </td>
                      <td><input id="finalMass" type="text" name="finalMass" placeholder="Final Product Mass" class="finalMass"/></td>
                      <td><input id="distributionCost" type="text" name="distributionCost" placeholder="Distribution Cost" class="distributionCost" /></td>                                      
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonCDown" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1CDown" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountCDown"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabaseCDown" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>

            <!-- <li style="font-size:12pt"> Importing a database</li> -->
            <input type="radio" id="importDatabase" name="databaseMethod" value="importDatabase">
            <label for="importDatabase"><i>Importing a database</i></label>

            <div id="readyTableDivCup" class="container mt-4 a" style="display: none;">
              <!-- <canvas id="canvasLifeExpectancy"> -->
                <div id="dvImportSegmentsCup" class="fileupload ">
                  <fieldset>
                    <legend>Upload your CSV File for C Upstream (Cup)</legend>
                    <input type="file" name="File Upload" id="txtFileUploadCup" accept=".csv" />
                  </fieldset>
                  <div id="csv-displayCup">
                    <table id="CSVtableCup" class="display"></table>
                  </div>
                  <input id="addNewProcessButton2Cup" type="button" value="Add new process" class="addNewProcessButton2" />
                  <label id="processCount2Cup"> Processes: 0/2 </label>
                  <label id="csvTableErrorMessage" value="" style="color:red"></label>
                </div>
              <!-- </canvas> -->
            </div>

            <div id="readyTableDivCmid" class="container mt-4 a" style="display: none;">
              <div id="dvImportSegmentsCmid" class="fileupload ">
                <fieldset>
                  <legend>Upload your CSV File for C Midstream (Cmid)</legend>
                  <input type="file" name="File Upload" id="txtFileUploadMid" accept=".csv" />
                </fieldset>
                <div id="csv-displayCmid">
                  <table id="CSVtableCmid" class="display"></table>
                </div>
                <input id="addNewProcessButton2Cmid" type="button" value="Add new process" class="addNewProcessButton2" />
                <label id="processCount2Cmid"> Processes: 0/2 </label>
                <label id="csvTableErrorMessageCmid" value="" style="color:red"></label>
              </div>
            </div>

            <div id="readyTableDivCdown" class="container mt-4 a" style="display: none;">
              <div id="dvImportSegmentsCdown" class="fileupload ">
                <fieldset>
                  <legend>Upload your CSV File for C Downtream (Cdown)</legend>
                  <input type="file" name="File Upload" id="txtFileUploadCdown" accept=".csv" />
                </fieldset>
                <div id="csv-displayCdown">
                  <table id="CSVtableCdown" class="display"></table>
                </div>
                <input id="addNewProcessButton2Cdown" type="button" value="Add new process"  class="addNewProcessButton2"/>
                <label id="processCount2Cdown"> Processes: 0/2 </label>
                <label id="csvTableErrorMessageCdown" value="" style="color:red"></label>
              </div>
            </div>            

            <p>&nbsp;</p>
            
            <!-- <input type="radio" id="exportDatabase" name="databaseMethod" value="exportDatabase">
            <label for="exportDatabase"><i>Exporting a database</i></label> -->
  

            <h3>-----------------------------------</h3>
            <h3 id="methodHeader">Phase 3. Life cycle impact assessment (LCIA):</h3>
            <li style="font-size:12pt"> Method selection</li>
            <!-- The same name allows the one of the two radio buttons to be selected -->
            <input type="radio" id="economicMethod" name="method" value="economicMethod">
            <label for="economicMethod"><i>Economic analysis method: </i> <br>
              <i> Cup = Raw Material Mass * Collection/Transportation Cost,<br> Cmid = Raw Material Mass * Production Cost, <br>
                Cdown = Final Product Mass * Distribution Cost </i> <br>
            </label><br>
            <p>&nbsp;</p>

            <input type="radio" id="method4" name="method" value="method4">
            <label for="method4"><i>Method developed by user (comming soon)</i></label><br>

            <h3>-----------------------------------</h3>

            <p>&nbsp;</p>
            <li style="font-size:12pt">Results</li>
            <p id='Result1'>Case Study Result : </p>
            <p id='Result2'>Proposed Study Result : </p>

            <p>&nbsp;</p>

            <h3>-----------------------------------</h3>
            <h3 id="phase4Header">Phase 4: Interpretation:</h3>
            <li style="font-size:12pt"> Analyzing the results and comparison</li>

            <canvas id="myChart" style="height: 370px; width: 100%;"></canvas>
            <p>&nbsp;</p>
            <li style="font-size:12pt"> Generating a PDF report <button type="reportButton"
                id="generateReport">Generate</button></li>
            <p>&nbsp;</p>

            </ul>
            <p>&nbsp;</p>

            <article id="TEA" class="panel">
              <header>
              <h2>Techno-economic Assessment (TEA)</h2>
              </header>
              
              
              <p align="justify" class="panel">
              The following studies include various TEA methods developed by our research group:
              <ul style="list-style-type:circle">
                <li style="font-size:12pt"> <i><a href="https://www.sciencedirect.com/science/article/abs/pii/S0306261920312678">
                Techno-economic and environmental assessments for nutrient-rich biochar production from cattle manure: A case study in Idaho, USA</a></i></li>
                <li style="font-size:12pt"> <i><a href="https://ir.library.oregonstate.edu/concern/graduate_thesis_or_dissertations/cc08hm25d">
                Techno-Economic Optimization and Environmental Impact Analysis for a Mixed-Mode Upstream and Midstream Forest Biomass to Bio-Products Supply Chain</a></i></li>
                <li style="font-size:12pt"> <i><a href="https://www.sciencedirect.com/science/article/abs/pii/S0306261917312746">
                A mixed biomass-based energy supply chain for enhancing economic and environmental sustainability benefits: A multi-criteria decision making framework</a></i></li>
                <li style="font-size:12pt"> <i><a href="https://www.sciencedirect.com/science/article/abs/pii/S0959652615016522">
                Reducing the cost and environmental impact of integrated fixed and mobile bio-oil refinery supply chains</a></i></li>
                <li style="font-size:12pt"> <i><a href="https://www.researchgate.net/profile/Amin_Mirkouei/publication/341496109_Environmental_and_Economic_Impacts_of_Nitrogen_Trifluoride_at_an_Idaho_Semiconductor_Facility/links/5ec47d7c458515626cb83833/Environmental-and-Economic-Impacts-of-Nitrogen-Trifluoride-at-an-Idaho-Semiconductor-Facility.pdf">
                Environmental and Economic Impacts of Nitrogen Trifluoride at an Idaho Semiconductor Facility</a></i></li>	
                <li style="font-size:12pt"> <i><a href="https://asmedigitalcollection.asme.org/IDETC-CIE/proceedings-abstract/IDETC-CIE2017/58165/V004T05A005/256781">
                Enhancing Economic and Environmental Sustainability Benefits Across the Design and Manufacturing of Medical Devices: A Case Study of Ankle Foot Orthosis</a></i></li>
                </ul>
                  
            </article>

            <p>
              <small>
                Contributors:        
                <ol>
                  <li> <b>Amin Mirkouei</b> initially came up with this idea for his sustainability class. He is contributing to the structure (phases), mathematical modeling, and web development.</li>
                  <li> <b>Justin Walters</b> has contributed to the method development for social LCA.</li>
                  <li> <b>George Makrakis</b> is contributing to the web development.</li>
                </ol>
              </small>
            </p>

            
            <!-- end .content -->
      </div>
      <div class="footer">
        </i></a></span></div>
      <p> &copy; 2018 IDeaL . <a href="http://www.uidaho.edu/" align="center" title="IDeaL Research Group"
          rel="bookmark" ; float: center">University of Idaho</a></p>
    </div>
    </div>



    <p>&nbsp;</p>
    <!-- end .footer -->
    </div>
    <!-- end .container -->
    </div>
  </body>

  <script type="text/javascript">

    $(document).ready(function () {

      //$('#customTable').DataTable();

      var tableCup = null;
      var tableCmid = null;
      var tableCdown = null;

      var selectedMethodId = null;

      var customTableCup = $('#customTableCup').dataTable();
      var customTableCMid = $('#customTableCMid').dataTable();
      var customTableCDown = $('#customTableCDown').dataTable();

      var ctx = document.getElementById('myChart').getContext('2d');
      var chart = initializeChart(ctx);

      var resultsCup = {
        result1 : 0,
        result2 : 0,
        error : null
      };
      var resultsCmid= {
        result1 : 0,
        result2 : 0,
        error : null
      };
      var resultsCdown = {
        result1 : 0,
        result2 : 0,
        error : null
      };

      $('input:radio[name="databaseMethod"]').click(
        function () {
          if (this.value == 'createDatabase') {

            // Group those in one div
            $("#customTableDivCup").css("display", "block");
            $("#customTableDivCMid").css("display", "block");
            $("#customTableDivCDown").css("display", "block");

            $("#readyTableDivCup").css("display", "none");
            $("#readyTableDivCmid").css("display", "none");
            $("#readyTableDivCdown").css("display", "none");
            $("#readyTableDivSafety").css("display", "none");

            resultsCup.result1 = 0;
            resultsCup.result2 = 0;
            resultsCup.error = null;

            resultsCmid.result1 = 0;
            resultsCmid.result2 = 0;
            resultsCmid.error = null;

            resultsCdown .result1 = 0;
            resultsCdown.result2 = 0;
            resultsCdown.error = null;

          }
          if (this.value == 'importDatabase') {
            
            // Group those in one div
            $("#readyTableDivCup").css("display", "block");
            $("#readyTableDivCmid").css("display", "block");
            $("#readyTableDivCdown").css("display", "block");
            $("#readyTableDivSafety").css("display", "block");
            
            $("#customTableDivCup").css("display", "none");
            $("#customTableDivCMid").css("display", "none");
            $("#customTableDivCDown").css("display", "none");

            resultsCup.result1 = 0;
            resultsCup.result2 = 0;
            resultsCup.error = null;

            resultsCmid.result1 = 0;
            resultsCmid.result2 = 0;
            resultsCmid.error = null;

            resultsCdown .result1 = 0;
            resultsCdown.result2 = 0;
            resultsCdown.error = null;      
          }
        }
      );

      $('input:radio[name="method"]').click(
        function () {
          if (this.value == 'economicMethod') {

            var indicator1 = "Cup";
            var indicator2 = "Cmid";
            var indicator3 = "Cdown"            

            $('#Result1').replaceWith("<p id='Result1'>Case Study Result: <br>"+ indicator1+": <i> "+ resultsCup.result1 + "</i>"+
              "<br> "+indicator2+": <i>" + resultsCmid.result1 + "</i> <br> "+indicator3+": <i>" + resultsCdown.result1 + "</i></p>");

            $('#Result2').replaceWith("<p id='Result2'>Proposed Study Result:<br>"+ indicator1+": <i> "+ resultsCup.result2 + "</i>"+
              "<br> "+indicator2+": <i>" + resultsCmid.result2 + "</i> <br> "+indicator3+": <i>" + resultsCdown.result2 + "</i></p>");
            
            // updateChart(chart, label, results.result1, results.result2);            
            updateChart(chart, [indicator1, indicator2, indicator3], resultsCup, resultsCmid, resultsCdown);                       
          }
         
        }
      );      

      // Here once the user select the appropraite checkbox, we perform the corresponding calculation
      $(".addNewProcessButton2").click(
        function () {

          selectedMethodId = $(this).attr("id");

          $("#csvTableErrorMessage").text("");

          if ($(this).attr("id") === 'addNewProcessButton2Cup' && tableCup != null) {                    
            if (resultsCup.result1 != 0 && resultsCup.result2 == 0) {
              resultsCup.result2 =  createResultsFromCSVTable(tableCup);              
              $("#processCount2Cup").replaceWith("<label id='processCount2Cup'> Processes: 2/2 </label>");
            }
            if (resultsCup.result1 == 0 && resultsCup.result2 == 0) {
              resultsCup.result1 =  createResultsFromCSVTable(tableCup);
              $("#processCount2Cup").replaceWith("<label id='processCount2Cup'> Processes: 1/2 </label>");
            }
            if (resultsCup.result2 === null 
                || resultsCup.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                       
          }

          if ($(this).attr("id") === 'addNewProcessButton2Cmid' && tableCmid != null) {
            
            if (resultsCmid.result1 != 0 && resultsCmid.result2 == 0) {
              resultsCmid.result2 =  createResultsFromCSVTable(tableCmid);
              $("#processCount2Cmid").replaceWith("<label id='processCount2Cmid'> Processes: 2/2 </label>");
            }
            if (resultsCmid.result1 == 0 && resultsCmid.result2 == 0) {
              resultsCmid.result1 =  createResultsFromCSVTable(tableCmid);
              $("#processCount2Cmid").replaceWith("<label id='processCount2Cmid'> Processes: 1/2 </label>");
            }
            if (resultsCmid.result2 === null 
                || resultsCmid.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                      
          }
          
          if ($(this).attr("id") === 'addNewProcessButton2Cdown' && tableCdown != null) {
            
            if (resultsCdown.result1 != 0 && resultsCdown.result2 == 0) {
              resultsCdown.result2 =  createResultsFromCSVTable(tableCdown);
              $("#processCount2Cdown").replaceWith("<label id='processCount2Cdown'> Processes: 2/2 </label>");
            }
            if (resultsCdown.result1 == 0 && resultsCdown.result2 == 0) {
              resultsCdown.result1 =  createResultsFromCSVTable(tableCdown);
              $("#processCount2Cdown").replaceWith("<label id='processCount2Cdown'> Processes: 1/2 </label>");
            }
            if (resultsCdown.result2 === null 
                || resultsCdown.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                       
          }          

          // Add the rest of the methods here (probably seperate functions)
        }
      );

      $(".addNewProcessButton1").click(

        // This function should be for the manually populated table
        function () {
          if ($(this).attr("id") === 'addNewProcessButton1Cup' && customTableCup != null) {
            var mass_elements =$('#customTableCup tbody .rawMass');
            var cost_elements =$('#customTableCup tbody .transportationCost');     
            
            var indicator = "Cup";            
          
            if (resultsCup.result1 != 0 && resultsCup.result2 == 0) {
              resultsCup.result2 =  getResults(mass_elements, cost_elements);
              $("#processCountCup").replaceWith("<label id='processCountCup> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabaseCup").click(function(){exportTableToCSVEconomic(indicator, indicator+'_Process2.csv', 2, 1)});
              $("#exportDatabaseCup").css("display", "block");
            }
            if (resultsCup.result1 == 0 && resultsCup.result2 == 0) {          
              resultsCup.result1 =  getResults( mass_elements, cost_elements);
              $("#processCountCup").replaceWith("<label id='processCountCup'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEconomic(indicator, indicator+'_Process1.csv', 1, 1);
            }            
            
          }

          if ($(this).attr("id") === 'addNewProcessButton1CMid' && customTableCMid != null) {
            var mass_elements = $('#customTableCMid tbody .rawMass');
            var cost_elements = $('#customTableCMid tbody .productionCost');           
            
            var indicator = "Cmid";            

            if (resultsCmid.result1 != 0 && resultsCmid.result2 == 0) {
              resultsCmid.result2 =  getResults(mass_elements, cost_elements);
              $("#processCountCMid").replaceWith("<label id='processCountCMid'> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabaseCMid").click(function(){exportTableToCSVEconomic(indicator, indicator+'_Process2.csv', 2, 2)});
              $("#exportDatabaseCMid").css("display", "block");
            }
            if (resultsCmid.result1 == 0 && resultsCmid.result2 == 0) {
              resultsCmid.result1 =  getResults( mass_elements, cost_elements);
              $("#processCountCMid").replaceWith("<label id='processCountCMid'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEconomic(indicator, indicator+'_Process1.csv', 1, 2);
            }            
            
          }

          if ($(this).attr("id") === 'addNewProcessButton1CDown' && customTableCDown != null) {
            var mass_elements =$('#customTableCDown tbody .finalMass');
            var cost_elements =$('#customTableCDown tbody .distributionCost');  
            
            var indicator = "Cdown";      

            if (resultsCdown.result1 != 0 && resultsCdown.result2 == 0) {
              resultsCdown.result2 =  getResults(mass_elements, cost_elements);
              $("#processCountCDown").replaceWith("<label id='processCountCDown'> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabaseCDown").click(function(){exportTableToCSVEconomic(indicator, indicator+'_Process2.csv', 2, 3)});
              $("#exportDatabaseCDown").css("display", "block");
            }
            if (resultsCdown.result1 == 0 && resultsCdown.result2 == 0) {
              resultsCdown.result1 =  getResults(mass_elements, cost_elements);
              $("#processCountCDown").replaceWith("<label id='processCountCDown'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEconomic(indicator, indicator+'_Process1.csv', 1, 3);
            }            
            
          }

            
      });

      function getResults(mass_elements, emFactor_elements, distance_elements){
          $("#customTableErrorMessage").text("");

            // if($("input[name='indicator']").length == 1 && ($("#indicator").val() !== 'lifeExpectancy')){
            //   $("#customTableErrorMessage").text("Incorrect indicator option selected");
            //   return;
            // }

            selectedMethodId = "Economical Analysis Method";           

            var masses = [];
            mass_elements.each(function () {
              masses.push($(this).val());
            });
            
            var emFactors = [];
            emFactor_elements.each(function () {              
              emFactors.push($(this).val());
            }); 
            
            var distances = [];
            if(distance_elements != null){
              distance_elements.each(function () {              
                distances.push($(this).val());
              });
            }

            return createResultsFromCustomTable(masses, emFactors, distances);          
      }

      // The event listener for the file uploads
      document.getElementById('txtFileUploadCup').addEventListener('change', upload, false);    
      document.getElementById('txtFileUploadMid').addEventListener('change', upload, false);
      document.getElementById('txtFileUploadCdown').addEventListener('change', upload, false);

      // TODO: Add the rest of the events here, pass the ID of the csv somehow (see this.id) and then convert the addNewProcessButton2
      // to have the appropriate button ID and to call the same fucntion based on the if statements

      // Method that checks that the browser supports the HTML5 File API
      function browserSupportFileUpload() {
        var isCompatible = false;
        if (window.File && window.FileReader && window.FileList && window.Blob) {
          isCompatible = true;
        }
        return isCompatible;
      }

      $(".addButton").click(function () {

        //var str ="<tr><td></td><td><input id='email' type='email' name='email' placeholder='Email'/></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td></tr>'";

        // $('#customTable tbody').append(str);

        if($(this).attr('id') === 'addButtonCup'){
            addRows(customTableCup,1);
        }
        
        if($(this).attr('id') === 'addButtonCMid'){
            addRows(customTableCMid,2);
        } 

        if($(this).attr('id') === 'addButtonCDown'){
            addRows(customTableCDown);
        }       
      });

      function addRows(customTable,extra){
        if(extra === 1){
          customTable.dataTable().fnAddData([
            "",
            "<input id='rawMass' type='text' name='rawMass' placeholder='Raw Material Mass' class='rawMass' />",
            "<input id='transportationCost' type='text' name='transportationCost' placeholder='Transportation Cost' class='transportationCost' />"
          ]);

          return;
        }
        if(extra === 2){
          customTable.dataTable().fnAddData([
            "",         
            "<input id='rawMass' type='text' name='rawMass' placeholder='Raw Material Mass' class='rawMass' />",
            "<input id='productionCost' type='text' name='productionCost' placeholder='Production Cost' class='productionCost' />"
          ]);

          return;
        }
        customTable.dataTable().fnAddData([
          "",
          "<input id='finalMass' type='text' name='finalMass' placeholder='Final Product Mass' class='finalMass'/>",
          "<input id='distributionCost' type='text' name='distributionCost' placeholder='Distribution Cost' class='distributionCost' />"
        ]);
      }


      // Method that reads and processes the selected file
      function upload(evt) {        
        if (!browserSupportFileUpload()) {
          alert('The File APIs are not fully supported in this browser!');
        }
        else {          
          var data = null;
          var file = evt.target.files[0];
          var reader = new FileReader();
          reader.readAsText(file);

          var uploadId = this.id;

          reader.onload = function (event) {
            var csvData = event.target.result;
            data = $.csv.toArrays(csvData);                     
                      
            if(uploadId === 'txtFileUploadCup'){             
              // We clear the table from previous data
              if (tableCup != null) {
                tableCup.destroy();
                $('#CSVtableCup').empty();              
              }
                                        
              if(checkCSVHeader(data,1) == false){
                console.log("Dataset must have five columns and have the header of 'Indicator,Metric,Location,Score,Total Score'");
              }        

              tableCup = populateTable(data, $('#CSVtableCup'));                         
            }

            if(uploadId === 'txtFileUploadCmid'){
              if (tableCmid != null) {
                tableCmid.destroy();
                $('#CSVtableCmid').empty();              
              }
              
              if(checkCSVHeader(data,2) == false){
                console.log("Dataset must have five columns and have the header of 'Indicator,Metric,Location,Score,Total Score'");
              } 
              
              tableCmid = populateTable(data,$('#CSVtableCmid'));
            }

            if(uploadId === 'txtFileUploadCdown'){
              if (tableCdown != null) {
                tableCdown.destroy();
                $('#CSVtableCdown').empty();              
              }

              if(checkCSVHeader(data,3) == false){
                console.log("Dataset must have five columns and have the header of 'Indicator,Metric,Location,Score,Total Score'");
              } 

              tableCdown = populateTable(data,$('#CSVtableCdown'));
            }           

          };
          reader.onerror = function () {
            alert('Unable to read ' + file.fileName);
          };
        }
      }

      $("#generateReport").click(async function () {

        // This fucntionality should be implemented using a Unit Testing framework
        //updateChart(chart, "Life Exprectancy", 1000000, 3000000);

        //Get the rest of the HTML elemensts here (name, scope, GWP etc.)

        // Get the canvas from the HTML
        var canvas = document.querySelector('#myChart');
        //creates image
        var canvasImg = canvas.toDataURL("image/png", 1.0);

        // We add all the info into one list in order to put them into the pdf   
        var list = [];
        // Add the info
        list.push($("#infoHeader").text());
        list.push($("#projectName").val());
        list.push($("#name").val());
        list.push($("#email").val());

        // Add the description
        list.push($("#scopeHeader").text());

        list.push($("textarea#phase1Text").val());
        
        // list.push($("#phase2Header").text());

        // TODO:This should be wrapped in an if()
        let LifeExpectancyTablePromise = new Promise ((resolve,reject) => { 
          window.scrollTo(0, 0);
          html2canvas($('#csv-displayLifeExpectancy')[0]).then(function (canvas) {
                var LifeExpectancyTableImg = canvas.toDataURL("image/png", 1.0);            
                resolve(LifeExpectancyTableImg);                   
              });                
        });


        // Add the selected equation
        list.push($("#methodHeader").text());
        // list.push($("label[for='"+selectedMethodId+"']").val());

        var equation_image = null;
        // Add the result
        if ($('input[id=environmentalMethod]:checked')) {
          // list.push($("label[for='environmentalMethod']").text());                          

          equation_image = document.querySelector('#indicator_image').getAttribute("src");                                      
        }

        list.push("Results:");

        list.push($("#Result1").text());
        list.push($("#Result2").text());

        list.push($("#phase4Header").text());

        // Remove the 'screenshot' of CSV table for now, there will be problem if we have table the spans in more than one 'table pages'
        // var LifeExpectancyTablePromiseResult = await LifeExpectancyTablePromise;
        // console.log("++++"+LifeExpectancyTablePromiseResult);        
        // createPDF(canvasImg, LifeExpectancyTablePromiseResult, list);

        createPDF(canvasImg, null, equation_image, list);
      });
    });



    function populateTable(dataSet, tableElement) {
      if (typeof (dataSet[0]) === 'undefined') {
        return null;
      }
      else {
        var columns = [];
        var data = [];
        $.each(dataSet, function (index, row) {

          // The first row of the csv data is going to be represent each column in our HTML table
          if (index == 0) {
            $.each(row, function (index, colData) {
              columns.push({ title: colData });
            });
          } // Then we just have the rest of the data
          else {
            data.push(row);
          }

        });


        // We assign the above data and columns and some attributes to display on the table.
        return tableElement.DataTable({
          data: data,
          columns: columns,
          select: {
            style: 'single',
            items: 'row'
          },
          // dom: 'Bfrtip',
          // buttons: [
          //     {
          //         text: 'Get selected data',
          //         action: function () {
          //             // var count = table.rows( { selected: true } ).count();

          //             // events.prepend( '<div>'+count+' row(s) selected</div>' );
          //             // console.log(table.rows({seleted: true}).data()[0]);
          //             var data  = table.rows({seleted: true}).data()[0];

          //             var result = data[0]*data[1]+data[2]*data[3];
          //             console.log(data);

          //             results.append($( "<i>"+result+"</i>"));
          //         }
          //     }
          // ]        
        });
      }


    }

  </script>

  <!-- The library for the charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

  <!--LCA Tool ends-->
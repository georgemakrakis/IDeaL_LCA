<!DOCTYPE>
<!Designed by Amin Mirkouei>
  <html class="ie ie7 no-js" lang="en-US">
  <html class="ie ie8 no-js" lang="en-US">
  <html class="no-js" lang="en-US">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IDEAL Research Group @ Uni. of Idaho</title>
    <link rel="stylesheet" href="css/Ica.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
    <link href="twoColLiqLtHdr.css" rel="stylesheet" type="text/css" />
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-101336701-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery-3.5.1.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery.csv-0.71.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
    <script src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>

    <!-- The library for the pdf creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.1.1/jspdf.umd.min.js" type="module"></script>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Move the logic at the end of this file to lca.js -->
    <script src="js/lca.js" type="text/javascript"></script>

  </head>

  <body>
    <div class="container">
      <div class="header">
        <div>
          <div style="height: 35px; background-color: #FFC300  ; border-bottom: #000000; margin-bottom: 10px;">
          </div>
          <h2 class="text">
            <a href="https://www.uidaho.edu/idaho-falls">
              <img src="UI.JPG" class="panel" style="width: 271px; height: 90px; float: left;" /></a></h2>
          <h2 class="panel" align="center">Innovative Design and Manufacturing Laboratory<img src="ideal.JPG"
              class="panel" style="width: 271px; height: 90px; float:right;" /></a></h2>
          <h2 class="panel" align="center">PI: Dr. Amin Mirkouei</a></h2>
        </div>
        <div style="height: 17px; background-color: #808080; border-bottom: #b39700; margin-bottom: 30px;">
        </div>
        <!-- end .header -->
      </div>

      <div class="sidebar1">
        <nav class="menu">
          <p><a href="index.html">Home</a></p>
          <p><a href="lca.html">LCA</a></p>
          <p><a href="economic.html">Economic Assessment</a></p>
          <p><a href="environmental.html">Envorinmental Assessment</a></p>
          <p><a href="social.html">Social Assessment</a></p>
        </nav>
        <!-- end .sidebar1 -->
      </div>

      <div class="content" style="width: 70%">
        <!-- LCA -->
        <article id="Life Cycle Assessment" class="panel">
          <header>
            <h2>Life Cycle Assessment (LCA)</h2>

            <p align="justify" class="panel">An open-source software for LCA and sustainability assessment is under
              construction in this webpage.</p>
            <p>&nbsp;</p>
            <h3>Getting started:</h3>
            <li style="font-size:12pt"> Manuals, case studies, and databases are available <b><a
                  href="manual.html">here.</b></a></li>

            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="infoHeader">Name of the project, Name and Email:</h3>

            <table>
              <tr>
                <td><input id="projectName" type="text" name="projectName" placeholder="Name of the project" /></td>
              </tr>
              <tr>
                <td><input id="name" type="text" name="name" placeholder="Name" /></td>
                <td><input id="email" type="email" name="email" placeholder="Email" /></td>
              </tr>
            </table>


            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="scopeHeader">Phase 1. Goal and scope definition:</h3>
            <li style="font-size:12pt"> <b>Define your goal, scope, system boundary, functional unit, and case study
                assumptions down here:</b></li>

            <textarea id="phase1Text" name="phase1Text" rows="4" cols="50">

  </textarea>

            <li style="font-size:12pt"> <b>Example:</b> LCA performed herein evaluates GWP for the manure to valueadded
              products life cycle. GHG emission factors are used to calculate the
              GWP (in kg CO2 equivalent) with the key factors being 28 kg CO2 eq./kg
              CH4 and 265 kg CO2 eq./kg N2O, which are acquired from the Intergovernmental
              Panel on Climate Change for a 100-year time horizon. The <b>scope</b> of this study includes four distinct
              stages that can be
              categorized into two processes: (i) upstream processes, including raw material (cattle manure) collection,
              and (ii) midstream processes,
              involving on-site pretreatment (dewatering and size reduction), on-site converting manure to intermediate
              products (biochar, bio-oil, and pyrolysis
              gas), on-site reusing intermediate products (e.g., bio-oil and pyrolysis gas) for pretreatment purposes
              (i.e., heat and electricity), and
              biochar distribution. This <b>scope considers a cradle-to-gate system boundary</b>. The <b>functional
                unit</b> in this study is one kilogram of
              biochar, using the identified scope.</li>

            <h3>-----------------------------------</h3>
            <h3>Phase 2. Life cycle inventory (LCI):</h3>
            <!-- <li style="font-size:12pt"> Creating a database</li> -->

            <input type="radio" id="createDatabase" name="databaseMethod" value="createDatabase">
            <label for="createDatabase"><i>Creating a database</i></label>

            <div id="customTableDiv" style="display: none;">
              <table id="customTable" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Metric</th>
                    <th>Location</th>
                    <th>Value</th>
                    <th>Total Population</th>
                    <th>Weight</th>
                    <th>w_i</th>
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        <select name="indicator" id="indicator">
                          <option value="lifeExpectancy">Life Expectancy</option>
                          <option value="health">Health</option>
                          <option value="education">Education</option>
                          <option value="safety">Safety</option>
                        </select>
                      </td>
                      <td><input id="metric" type="text" name="metric" placeholder="Metric" /></td>
                      <td><input id="location" type="text" name="location" placeholder="Location" /></td>
                      <td><input id="value" type="text" name="value" placeholder="Value" /></td>
                      <td><input id="population" type="text" name="population" placeholder="Total Population" /></td>
                      <td><input id="weight" type="text" name="weight" placeholder="Weight" /></td>
                      <td><input id="w_i" type="text" name="w_i" placeholder="w_i" /></td>
                    </tr>
                  </tbody>
              </table>
              <input id="addButton" type="button" value="Add new record" />
              <input id="addNewProcessButton1" type="button" value="Add new process" />
              <label id="customTableErrorMessage" value="" style="color:red"></label>

            </div>
            <p>&nbsp;</p>

            <!-- <li style="font-size:12pt"> Importing a database</li> -->
            <input type="radio" id="importDatabase" name="databaseMethod" value="importDatabase">
            <label for="importDatabase"><i>Importing a database</i></label>

            <div id="readyTableDiv" class="container mt-4" style="display: none;">
              <div id="dvImportSegments" class="fileupload ">
                <fieldset>
                  <legend>Upload your CSV File</legend>
                  <input type="file" name="File Upload" id="txtFileUpload" accept=".csv" />
                </fieldset>
                <div id="csv-display">
                  <table id="CSVtable" class="display"></table>
                </div>
                <input id="addNewProcessButton2" type="button" value="Add new process" />
                <label id="csvTableErrorMessage" value="" style="color:red"></label>
              </div>
            </div>

            <p>&nbsp;</p>
            <!-- <li style="font-size:12pt"> Exporting a database</li> -->
            <input type="radio" id="exportDatabase" name="databaseMethod" value="exportDatabase">
            <label for="exportDatabase"><i>Exporting a database</i></label>


            <h3>-----------------------------------</h3>
            <h3 id="methodHeader">Phase 3. Life cycle impact assessment (LCIA):</h3>
            <li style="font-size:12pt"> Method selection</li>
            <!-- The same name allows the one of the two radio buttons to be selected -->
            <input type="radio" id="socialMethod" name="method" value="socialMethod">
            <label for="socialMethod"><i>Social analysis method:</i> <br>Total social value = Sum of indicator values =
              (Sum of number of metrics * sum of number of locations * w_i) / number of metrics</label><br>
            <p>&nbsp;</p>

            <input type="radio" id="method4" name="method" value="method4">
            <label for="method4"><i>Method developed by user (comming soon)</i></label><br>

            <h3>-----------------------------------</h3>

            <p>&nbsp;</p>
            <li style="font-size:12pt">Results</li>
            <p id='socialResult1'>Social Result Process 1 = </p>
            <p id='socialResult2'>Social Result Process 2 = </p>

            <p>&nbsp;</p>

            <h3>-----------------------------------</h3>
            <h3>Phase 4: Interpretation:</h3>
            <li style="font-size:12pt"> Analyzing the results and comparison</li>
            <p>Table</p>
            <p>Plot</p>

            <canvas id="myChart" style="height: 370px; width: 100%;"></canvas>
            <p>&nbsp;</p>
            <li style="font-size:12pt"> Generating a PDF report <button type="reportButton"
                id="generateReport">Generate</button></li>
            <p>&nbsp;</p>

            </ul>
            <p>&nbsp;</p>


            <p>&nbsp;</p>
            <!-- end .content -->
      </div>
      <div class="footer">
        </i></a></span></div>
      <p> &copy; 2018 IDeaL . <a href="http://www.uidaho.edu/" align="center" title="IDeaL Research Group"
          rel="bookmark" ; float: center">University of Idaho</a></p>
    </div>
    </div>



    <p>&nbsp;</p>
    <!-- end .footer -->
    </div>
    <!-- end .container -->
    </div>
  </body>

  <script type="text/javascript">

    $(document).ready(function () {

      //$('#customTable').DataTable();

      var table = null;
      var selectedMethodId = null;

      var customTable = $('#customTable').DataTable();

      var ctx = document.getElementById('myChart').getContext('2d');
      var chart = initializeChart(ctx);

      var results = {
        result1 : 0,
        result2 : 0,
        error : null
      }

      $('input:radio[name="databaseMethod"]').click(
        function () {
          if (this.value == 'createDatabase') {
            $("#customTableDiv").css("display", "block");
            $("#readyTableDiv").css("display", "none");
          }
          if (this.value == 'importDatabase') {
            $("#readyTableDiv").css("display", "block");
            $("#customTableDiv").css("display", "none");
          }
        }
      );

      $('input:radio[name="method"]').click(
        function () {
          if (this.value == 'socialMethod') {
            $('#socialResult1').replaceWith("<p id='socialResult'>Social Result of Process 1 = <i>" + results.result1 + "</i></p>");
            $('#socialResult2').replaceWith("<p id='socialResult2'>Social Result of Process 2 = <i>" + results.result2 + "</i></p>");

            var label = $("#indicator").val();
            updateChart(chart, label, results.result1, results.result2);            
          }
         
        }
      );

      // Here once the user select the appropraite checkbox, we perform the corresponding calculation
      $("#addNewProcessButton2").click(
        function () {

          selectedMethodId = $(this).attr("id");

          $("#csvTableErrorMessage").text("");

          // This function should be for the CSV populated table
          results = createResultsFromCSVTable(table, selectedMethodId, chart);

          if (results.error === "One or more values in w_i is not a number") {
            $("#csvTableErrorMessage").text("One or more values in w_i is not a number");
          }         

          // Add the rest of the methods here (probably seperate functions)
        }
      );

      $("#addNewProcessButton1").click(

        // This function should be for the manually populated table
        function () {
          if (customTable != null) {

            $("#customTableErrorMessage").text("");

            // if($("input[name='indicator']").length == 1 && ($("#indicator").val() !== 'lifeExpectancy')){
            //   $("#customTableErrorMessage").text("Incorrect indicator option selected");
            //   return;
            // }

            selectedMethodId = $(this).attr("id");

            if ($("input[name='indicator']").length > 1) {
              $("#customTableErrorMessage").text("More than one indicators included");
              return;
            }

            var w_i = 1;
            var w_i_ok = true;

            // We traverse all rows to perform the required multiplication
            $("input[name='w_i']").each(function () {
              if ($.isNumeric($(this).val())) {
                w_i *= ($(this).val());
              }
              else {
                $("#customTableErrorMessage").text("One or more values in w_i is not a number");
                w_i_ok = false; // even if we find one string in the w_i's we put zero to that value
                return false;
              }
            });

            // If we have noticed a string we return
            if (!w_i_ok) {
              return;
            }

            var metrics = 0;
            $("input[name='metric']").each(function () {
              metrics++;
            });

            var countries = [];
            $("input[name='location']").each(function () {
              countries.push($(this).val());
            });

            // var uniqueCountries = Array.from(new Set(countries));        


            // var result = (metrics * uniqueCountries.length * w_i) / metrics;

            // // Round result to 2 decimal points
            // result = Math.round((result + Number.EPSILON) * 100) / 100

            // // console.log(result);

            // if(resultProcess1 != 0 && resultProcess2 == 0)
            // {
            //   resultProcess2 = result;
            // }
            // if(resultProcess1 == 0 && resultProcess2 == 0)
            // {
            //   resultProcess1 = result;
            // }

            // console.log(result);

            results = createResultsFromCustomTable(metrics, countries, w_i);            
          }
        });

      // The event listener for the file upload
      document.getElementById('txtFileUpload').addEventListener('change', upload, false);

      // Method that checks that the browser supports the HTML5 File API
      function browserSupportFileUpload() {
        var isCompatible = false;
        if (window.File && window.FileReader && window.FileList && window.Blob) {
          isCompatible = true;
        }
        return isCompatible;
      }

      $("#addButton").click(function () {

        //var str ="<tr><td></td><td><input id='email' type='email' name='email' placeholder='Email'/></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td></tr>'";

        // $('#customTable tbody').append(str);

        $('#customTable').dataTable().fnAddData([
          "",
          "<input id='metric' type='text' name='metric' placeholder='Metric' />",
          "<input id='location' type='text' name='location' placeholder='Location'/>",
          "<input id='value' type='text' name='value' placeholder='Value' />",
          "<input id='population' type='text' name='population' placeholder='Total Population' />",
          "<input id='weight' type='text' name='weight' placeholder='Weight' />",
          "<input id='w_i' type='text' name='w_i' placeholder='w_i' />"]);
      });

      // Method that reads and processes the selected file
      function upload(evt) {
        if (!browserSupportFileUpload()) {
          alert('The File APIs are not fully supported in this browser!');
        }
        else {
          var data = null;
          var file = evt.target.files[0];
          var reader = new FileReader();
          reader.readAsText(file);
          reader.onload = function (event) {
            var csvData = event.target.result;
            data = $.csv.toArrays(csvData);

            // We clear the table from previous data
            if (table != null) {
              table.destroy();
              $('#CSVtable').empty();
            }
            table = populateTable(data);

          };
          reader.onerror = function () {
            alert('Unable to read ' + file.fileName);
          };
        }
      }

      $("#generateReport").click(function () {

        // This fucntionality should be implemented using a Unit Testing framework
        updateChart(chart, "Life Exprectancy", 1000000, 3000000);

        //Get the rest of the HTML elemensts here (name, scope, GWP etc.)

        // Get the canvas from the HTML
        var canvas = document.querySelector('#myChart');
        //creates image
        var canvasImg = canvas.toDataURL("image/png", 1.0);

        // We add all the info into one list in order to put them into the pdf   
        var list = [];
        // Add the info
        list.push($("#infoHeader").text());
        list.push($("#projectName").val());
        list.push($("#name").val());
        list.push($("#email").val());

        // Add the description
        list.push($("#scopeHeader").text());
        list.push($("textarea#phase1Text").val());

        // Add the selected equation
        list.push($("#methodHeader").text());
        // list.push($("label[for='"+selectedMethodId+"']").val());

        // Add the result
        if (selectedMethodId === "socialMethod") {

          list.push($("#socialResult").text());
        }

        if (selectedMethodId === "environmentalMethod") {
          list.push($("#environmentalResult").text());
        }

        if (selectedMethodId === "economicMethod") {
          list.push($("#economicResult").text());
        }

        createPDF(canvasImg, list);
      });
    });



    function populateTable(dataSet) {
      if (typeof (dataSet[0]) === 'undefined') {
        return null;
      }
      else {
        var columns = [];
        var data = [];
        $.each(dataSet, function (index, row) {

          // The first row of the csv data is going to be represent each column in our HTML table
          if (index == 0) {
            $.each(row, function (index, colData) {
              columns.push({ title: colData });
            });
          } // Then we just have the rest of the data
          else {
            data.push(row);
          }

        });


        // We assign the above data and columns and some attributes to display on the table.
        return table = $('#CSVtable').DataTable({
          data: data,
          columns: columns,
          select: {
            style: 'single',
            items: 'row'
          },
          // dom: 'Bfrtip',
          // buttons: [
          //     {
          //         text: 'Get selected data',
          //         action: function () {
          //             // var count = table.rows( { selected: true } ).count();

          //             // events.prepend( '<div>'+count+' row(s) selected</div>' );
          //             // console.log(table.rows({seleted: true}).data()[0]);
          //             var data  = table.rows({seleted: true}).data()[0];

          //             var result = data[0]*data[1]+data[2]*data[3];
          //             console.log(data);

          //             results.append($( "<i>"+result+"</i>"));
          //         }
          //     }
          // ]        
        });
      }


    }

  </script>

  <!-- The library for the charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

  <!--LCA Tool ends-->
<!DOCTYPE>
<!Designed by Amin Mirkouei>
  <html class="ie ie7 no-js" lang="en-US">
  <html class="ie ie8 no-js" lang="en-US">
  <html class="no-js" lang="en-US">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IDEAL Research Group @ Uni. of Idaho</title>
    <!-- TODO: Fix the CSS -->
    <link rel="stylesheet" href="css/lca.css"> 
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
    <link href="twoColLiqLtHdr.css" rel="stylesheet" type="text/css" />
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-101336701-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery-3.5.1.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery.csv-0.71.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jquery.dataTables.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.select.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>
    
    <script src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.buttons.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>
    
    <script src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/dataTables.editor.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <!-- The library for the pdf creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.1.1/jspdf.umd.min.js" type="module"></script>
    <!-- <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/jspdf.umd.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script> -->

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
      if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='/js/html2canvas.min.js' type='text/javascript'%3E%3C/script%3E"));
      }
    </script>

    <script src="js/html2csv.js" type="text/javascript"></script>

    <!-- Move the logic at the end of this file to lca.js -->
    <script src="js/lca_environmental.js" type="text/javascript"></script>

  </head>

  <body>
    <div class="container">
      <div class="header">
        <div>
          <div style="height: 35px; background-color: #FFC300  ; border-bottom: #000000; margin-bottom: 10px;">
          </div>
          <h2 class="text">
            <a href="https://www.uidaho.edu/idaho-falls">
              <img src="UI.JPG" class="panel" style="width: 271px; height: 90px; float: left;" /></a></h2>
          <h2 class="panel" align="center">Innovative Design and Manufacturing Laboratory<img src="ideal.JPG"
              class="panel" style="width: 271px; height: 90px; float:right;" /></a></h2>
          <h2 class="panel" align="center">PI: Dr. Amin Mirkouei</a></h2>
        </div>
        <div style="height: 17px; background-color: #808080; border-bottom: #b39700; margin-bottom: 30px;">
        </div>
        <!-- end .header -->
      </div>

      <div class="sidebar1">
        <nav class="menu">
          <p><a href="index.html">Home</a></p>
          <p><a href="lca.html">LCA</a></p>
          <p><a href="economic.html">Economic Assessment</a></p>
          <p><a href="environmental.html">Envorinmental Assessment</a></p>
          <p><a href="social.html">Social Assessment</a></p>
        </nav>
        <!-- end .sidebar1 -->
      </div>

      <div class="content" style="width: 70%">
        <!-- LCA -->
        <article id="Life Cycle Assessment" class="panel">
          <header>
            <h2>Life Cycle Assessment (LCA) v0.01 - Environmental</h2>

            <p align="justify" class="panel">An open-source software for LCA and sustainability assessment.</p>
            <p>&nbsp;</p>
            <h3>Getting started:</h3>
            <li style="font-size:12pt"> Manuals, case studies, and databases are available <b><a
                  href="manual.html">here.</b></a></li>

            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="infoHeader">Name of the project, Name and Email:</h3>

            <table>
              <tr>
                <td><input id="projectName" type="text" name="projectName" placeholder="Name of the project" /></td>
              </tr>
              <tr>
                <td><input id="name" type="text" name="name" placeholder="Name" /></td>
                <td><input id="email" type="email" name="email" placeholder="Email" /></td>
              </tr>
            </table>


            <p>&nbsp;</p>
            <h3>-----------------------------------</h3>
            <h3 id="scopeHeader">Phase 1. Goal and scope definition:</h3>
            <li style="font-size:12pt"> <b>Define your goal, scope, system boundary, functional unit, and case study
                assumptions down here:</b></li>

            <textarea id="phase1Text" name="phase1Text" rows="4" cols="50">

            </textarea>

            <!-- <li style="font-size:12pt"> <b>Example:</b> LCA performed herein evaluates GWP for the manure to valueadded
              products life cycle. GHG emission factors are used to calculate the
              GWP (in kg CO2 equivalent) with the key factors being 28 kg CO2 eq./kg
              CH4 and 265 kg CO2 eq./kg N2O, which are acquired from the Intergovernmental
              Panel on Climate Change for a 100-year time horizon. The <b>scope</b> of this study includes four distinct
              stages that can be
              categorized into two processes: (i) upstream processes, including raw material (cattle manure) collection,
              and (ii) midstream processes,
              involving on-site pretreatment (dewatering and size reduction), on-site converting manure to intermediate
              products (biochar, bio-oil, and pyrolysis
              gas), on-site reusing intermediate products (e.g., bio-oil and pyrolysis gas) for pretreatment purposes
              (i.e., heat and electricity), and
              biochar distribution. This <b>scope considers a cradle-to-gate system boundary</b>. The <b>functional
                unit</b> in this study is one kilogram of
              biochar, using the identified scope.</li> -->

            <h3>-----------------------------------</h3>
            <h3 id="phase2Header">Phase 2. Life cycle inventory (LCI):</h3>
            <!-- <li style="font-size:12pt"> Creating a database</li> -->

            <input type="radio" id="createDatabase" name="databaseMethod" value="createDatabase">
            <label for="createDatabase"><i>Creating a database</i></label>

            <div id="customTableDivPup" style="display: none;">
              <table id="customTablePup" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Mass</th>
                    <th>Emission Factor Up</th>                    
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        P Upstream (Pup)
                      </td>
                      <td><input id="mass" type="text" name="mass" placeholder="Mass" class="mass"/></td>
                      <td><input id="emissionFactor" type="text" name="emissionFactor" placeholder="Emission Factor Up" class="emissionFactor" /></td>                      
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonPup" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1Pup" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountPup"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabasePup" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>


            <div id="customTableDivPMid" style="display: none;">
              <table id="customTablePMid" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Mass</th>
                    <th>Emission Factor Mid</th>                    
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        P Midstream (Pmid)
                      </td>
                      <td><input id="mass" type="text" name="mass" placeholder="Mass" class="mass"/></td>
                      <td><input id="emissionFactor" type="text" name="emissionFactor" placeholder="Emission Factor Up" class="emissionFactor" /></td>                      
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonPMid" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1PMid" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountPMid"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabasePMid" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>

            <div id="customTableDivPDown" style="display: none;">
              <table id="customTablePDown" style="table-layout:fixed; width: 100%;">
                <thead>
                  <tr>
                    <th>Indicator</th>
                    <th>Mass</th>
                    <th>Emission Factor Down</th>                    
                    <th>Distance</th>                    
                  </tr>
                  <thead>
                  <tbody>
                    <tr>
                      <td>
                        P Downstream (Pdown)
                      </td>
                      <td><input id="mass" type="text" name="mass" placeholder="Mass" class="mass"/></td>
                      <td><input id="emissionFactor" type="text" name="emissionFactor" placeholder="Emission Factor Up" class="emissionFactor" /></td>
                      <td><input id="distance" type="text" name="distance" placeholder="Distance" class="distance" /></td>                                        
                    </tr>
                  </tbody>
              </table>
              <input id="addButtonPDown" type="button" value="Add new record" class="addButton"/>
              <input id="addNewProcessButton1PDown" type="button" value="Add new process" class="addNewProcessButton1"/>
              <label id="processCountPDown"> Processes: 0/2 </label>
              <label id="customTableErrorMessage" value="" style="color:red"></label>
              <br>
              <input id="exportDatabasePDown" value="Export as CSV" type="button" style="display: none;">

            </div>
            <p>&nbsp;</p>

            <!-- <li style="font-size:12pt"> Importing a database</li> -->
            <input type="radio" id="importDatabase" name="databaseMethod" value="importDatabase">
            <label for="importDatabase"><i>Importing a database</i></label>

            <div id="readyTableDivPUp" class="container mt-4 a" style="display: none;">
              <!-- <canvas id="canvasLifeExpectancy"> -->
                <div id="dvImportSegmentsPUp" class="fileupload ">
                  <fieldset>
                    <legend>Upload your CSV File for P Upstream (Pup)</legend>
                    <input type="file" name="File Upload" id="txtFileUploadPup" accept=".csv" />
                  </fieldset>
                  <div id="csv-displayPUp">
                    <table id="CSVtablePUp" class="display"></table>
                  </div>
                  <input id="addNewProcessButton2PUp" type="button" value="Add new process" class="addNewProcessButton2" />
                  <label id="processCount2Pup"> Processes: 0/2 </label>
                  <label id="csvTableErrorMessage" value="" style="color:red"></label>
                </div>
              <!-- </canvas> -->
            </div>

            <div id="readyTableDivPmid" class="container mt-4 a" style="display: none;">
              <div id="dvImportSegmentsPmid" class="fileupload ">
                <fieldset>
                  <legend>Upload your CSV File for P Midstream (Pmid)</legend>
                  <input type="file" name="File Upload" id="txtFileUploadPmid" accept=".csv" />
                </fieldset>
                <div id="csv-displayPmid">
                  <table id="CSVtablePmid" class="display"></table>
                </div>
                <input id="addNewProcessButton2Pmid" type="button" value="Add new process" class="addNewProcessButton2" />
                <label id="processCount2Pmid"> Processes: 0/2 </label>
                <label id="csvTableErrorMessagePmid" value="" style="color:red"></label>
              </div>
            </div>

            <div id="readyTableDivPdown" class="container mt-4 a" style="display: none;">
              <div id="dvImportSegmentsPdown" class="fileupload ">
                <fieldset>
                  <legend>Upload your CSV File for P Downstream (Pdown)</legend>
                  <input type="file" name="File Upload" id="txtFileUploadPdown" accept=".csv" />
                </fieldset>
                <div id="csv-displayPdown">
                  <table id="CSVtablePdown" class="display"></table>
                </div>
                <input id="addNewProcessButton2Pdown" type="button" value="Add new process"  class="addNewProcessButton2"/>
                <label id="processCount2Pdown"> Processes: 0/2 </label>
                <label id="csvTableErrorMessagePdown" value="" style="color:red"></label>
              </div>
            </div>           

            <p>&nbsp;</p>
            
            <!-- <input type="radio" id="exportDatabase" name="databaseMethod" value="exportDatabase">
            <label for="exportDatabase"><i>Exporting a database</i></label> -->
  

            <h3>-----------------------------------</h3>
            <h3 id="methodHeader">Phase 3. Life cycle impact assessment (LCIA):</h3>
            <li style="font-size:12pt"> Method selection</li>
            <!-- The same name allows the one of the two radio buttons to be selected -->
            <input type="radio" id="environmentalMethod" name="method" value="environmentalMethod">
            <label for="environmentalMethod"><i>Environmental analysis method: </i> <br>
              <i> Pup = Mass * Emission Factor Up,<br> Pmid = Mass * Emission Factor Mid, <br>
              Pdown = Mass * Emission Factor Down * Distance </i> <br>
             
            </label><br>
            <p>&nbsp;</p>

            <input type="radio" id="method4" name="method" value="method4">
            <label for="method4"><i>Method developed by user (comming soon)</i></label><br>

            <h3>-----------------------------------</h3>

            <p>&nbsp;</p>
            <li style="font-size:12pt">Results</li>
            <p id='Result1'>Case Study Result : </p>
            <p id='Result2'>Proposed Study Result : </p>

            <p>&nbsp;</p>

            <h3>-----------------------------------</h3>
            <h3 id="phase4Header">Phase 4: Interpretation:</h3>
            <li style="font-size:12pt"> Analyzing the results and comparison</li>

            <canvas id="myChart" style="height: 370px; width: 100%;"></canvas>
            <p>&nbsp;</p>
            <li style="font-size:12pt"> Generating a PDF report <button type="reportButton"
                id="generateReport">Generate</button></li>
            <p>&nbsp;</p>

            </ul>
            <p>&nbsp;</p>

            <p>
              <small>
                Contributors:        
                <ol>
                  <li> <b>Amin Mirkouei</b> initially came up with this idea for his sustainability class. He is contributing to the structure (phases), mathematical modeling, and web development.</li>
                  <li> <b>Justin Walters</b> has contributed to the method development for social LCA.</li>
                  <li> <b>George Makrakis</b> is contributing to the web development.</li>
                </ol>
              </small>
            </p>

            
            <!-- end .content -->
      </div>
      <div class="footer">
        </i></a></span></div>
      <p> &copy; 2018 IDeaL . <a href="http://www.uidaho.edu/" align="center" title="IDeaL Research Group"
          rel="bookmark" ; float: center">University of Idaho</a></p>
    </div>
    </div>



    <p>&nbsp;</p>
    <!-- end .footer -->
    </div>
    <!-- end .container -->
    </div>
  </body>

  <script type="text/javascript">

    $(document).ready(function () {

      //$('#customTable').DataTable();

      var tablePup = null;
      var tablePmid = null;
      var tablePdown = null;
      var tableSafety = null;
      var selectedMethodId = null;

      var customTablePup = $('#customTablePup').dataTable();
      var customTablePMid = $('#customTablePMid').dataTable();
      var customTablePDown = $('#customTablePDown').dataTable();

      var ctx = document.getElementById('myChart').getContext('2d');
      var chart = initializeChart(ctx);

      var resultsPup = {
        result1 : 0,
        result2 : 0,
        error : null
      };
      var resultsPMid= {
        result1 : 0,
        result2 : 0,
        error : null
      };
      var resultsPDown = {
        result1 : 0,
        result2 : 0,
        error : null
      };

      $('input:radio[name="databaseMethod"]').click(
        function () {
          if (this.value == 'createDatabase') {

            // Group those in one div
            $("#customTableDivPup").css("display", "block");
            $("#customTableDivPMid").css("display", "block");
            $("#customTableDivPDown").css("display", "block");

            $("#readyTableDivPUp").css("display", "none");
            $("#readyTableDivPmid").css("display", "none");
            $("#readyTableDivPdown").css("display", "none");
            $("#readyTableDivSafety").css("display", "none");

            resultsPup.result1 = 0;
            resultsPup.result2 = 0;
            resultsPup.error = null;

            resultsPMid.result1 = 0;
            resultsPMid.result2 = 0;
            resultsPMid.error = null;

            resultsPDown .result1 = 0;
            resultsPDown.result2 = 0;
            resultsPDown.error = null;

          }
          if (this.value == 'importDatabase') {
            
            // Group those in one div
            $("#readyTableDivPUp").css("display", "block");
            $("#readyTableDivPmid").css("display", "block");
            $("#readyTableDivPdown").css("display", "block");
            $("#readyTableDivSafety").css("display", "block");
            
            $("#customTableDivPup").css("display", "none");
            $("#customTableDivPMid").css("display", "none");
            $("#customTableDivPDown").css("display", "none");

            resultsPup.result1 = 0;
            resultsPup.result2 = 0;
            resultsPup.error = null;

            resultsPMid.result1 = 0;
            resultsPMid.result2 = 0;
            resultsPMid.error = null;

            resultsPDown .result1 = 0;
            resultsPDown.result2 = 0;
            resultsPDown.error = null;      
          }
        }
      );

      $('input:radio[name="method"]').click(
        function () {
          if (this.value == 'environmentalMethod') {

            var indicator1 = "Pup";
            var indicator2 = "Pmid";
            var indicator3 = "Pdown"            

            $('#Result1').replaceWith("<p id='Result1'>Case Study Result: <br>"+ indicator1+": <i> "+ resultsPup.result1 + "</i>"+
              "<br> "+indicator2+": <i>" + resultsPMid.result1 + "</i> <br> "+indicator3+": <i>" + resultsPDown.result1 + "</i></p>");

            $('#Result2').replaceWith("<p id='Result2'>Proposed Study Result:<br>"+ indicator1+": <i> "+ resultsPup.result2 + "</i>"+
              "<br> "+indicator2+": <i>" + resultsPMid.result2 + "</i> <br> "+indicator3+": <i>" + resultsPDown.result2 + "</i></p>");
            
            // updateChart(chart, label, results.result1, results.result2);            
            updateChart(chart, [indicator1, indicator2, indicator3], resultsPup, resultsPMid, resultsPDown);                       
          }
         
        }
      );      

      // Here once the user select the appropraite checkbox, we perform the corresponding calculation
      $(".addNewProcessButton2").click(
        function () {

          selectedMethodId = $(this).attr("id");

          $("#csvTableErrorMessage").text("");

          if ($(this).attr("id") === 'addNewProcessButton2PUp' && tablePup != null) {                    
            if (resultsPup.result1 != 0 && resultsPup.result2 == 0) {
              resultsPup.result2 =  createResultsFromCSVTable(tablePup,1);              
              $("#processCount2Pup").replaceWith("<label id='processCount2Pup'> Processes: 2/2 </label>");
            }
            if (resultsPup.result1 == 0 && resultsPup.result2 == 0) {
              resultsPup.result1 =  createResultsFromCSVTable(tablePup,1);
              $("#processCount2Pup").replaceWith("<label id='processCount2Pup'> Processes: 1/2 </label>");
            }
            if (resultsPup.result2 === null 
                || resultsPup.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                       
          }

          if ($(this).attr("id") === 'addNewProcessButton2Pmid' && tablePmid != null) {
            
            if (resultsPMid.result1 != 0 && resultsPMid.result2 == 0) {
              resultsPMid.result2 =  createResultsFromCSVTable(tablePmid,2);
              $("#processCount2Pmid").replaceWith("<label id='processCount2Pmid'> Processes: 2/2 </label>");
            }
            if (resultsPMid.result1 == 0 && resultsPMid.result2 == 0) {
              resultsPMid.result1 =  createResultsFromCSVTable(tablePmid,2);
              $("#processCount2Pmid").replaceWith("<label id='processCount2Pmid'> Processes: 1/2 </label>");
            }
            if (resultsPMid.result2 === null 
                || resultsPMid.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                      
          }
          
          if ($(this).attr("id") === 'addNewProcessButton2Pdown' && tablePdown != null) {
            
            if (resultsPDown.result1 != 0 && resultsPDown.result2 == 0) {
              resultsPDown.result2 =  createResultsFromCSVTable(tablePdown,3);
              $("#processCount2Pdown").replaceWith("<label id='processCount2Pdown'> Processes: 2/2 </label>");
            }
            if (resultsPDown.result1 == 0 && resultsPDown.result2 == 0) {
              resultsPDown.result1 =  createResultsFromCSVTable(tablePdown,3);
              $("#processCount2Pdown").replaceWith("<label id='processCount2Pdown'> Processes: 1/2 </label>");
            }
            if (resultsPDown.result2 === null 
                || resultsPDown.result1 === null) {
              $("#csvTableErrorMessage").text("One or more values is not a number");
            }                       
          }          

          // Add the rest of the methods here (probably seperate functions)
        }
      );

      $(".addNewProcessButton1").click(

        // This function should be for the manually populated table
        function () {
          if ($(this).attr("id") === 'addNewProcessButton1Pup' && customTablePup != null) {
            var mass_elements =$('#customTablePup tbody .mass');
            var emFactor_elements =$('#customTablePup tbody .emissionFactor');     
            
            var indicator = "Pup";            
          
            if (resultsPup.result1 != 0 && resultsPup.result2 == 0) {
              resultsPup.result2 =  getResults(mass_elements, emFactor_elements);
              $("#processCountPup").replaceWith("<label id='processCountPup> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabasePup").click(function(){exportTableToCSVEnvironmental(indicator, indicator+'_Process2.csv', 2, 1)});
              $("#exportDatabasePup").css("display", "block");
            }
            if (resultsPup.result1 == 0 && resultsPup.result2 == 0) {          
              resultsPup.result1 =  getResults( mass_elements, emFactor_elements);
              $("#processCountPup").replaceWith("<label id='processCountPup'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEnvironmental(indicator, indicator+'_Process1.csv', 1, 1);
            }            
            
          }

          if ($(this).attr("id") === 'addNewProcessButton1PMid' && customTablePMid != null) {
            var mass_elements = $('#customTablePMid tbody .mass');
            var emFactor_elements = $('#customTablePMid tbody .emissionFactor');           
            
            var indicator = "Pmid";            

            if (resultsPMid.result1 != 0 && resultsPMid.result2 == 0) {
              resultsPMid.result2 =  getResults(mass_elements, emFactor_elements);
              $("#processCountPMid").replaceWith("<label id='processCountPMid> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabasePMid").click(function(){exportTableToCSVEnvironmental(indicator, indicator+'_Process2.csv', 2, 2)});
              $("#exportDatabasePMid").css("display", "block");
            }
            if (resultsPMid.result1 == 0 && resultsPMid.result2 == 0) {
              resultsPMid.result1 =  getResults( mass_elements, emFactor_elements);
              $("#processCountPMid").replaceWith("<label id='processCountPMid'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEnvironmental(indicator, indicator+'_Process1.csv', 1, 2);
            }            
            
          }

          if ($(this).attr("id") === 'addNewProcessButton1PDown' && customTablePup != null) {
            var mass_elements =$('#customTablePDown tbody .mass');
            var emFactor_elements =$('#customTablePDown tbody .emissionFactor');
            var distance_elements = $('#customTablePDown tbody .distance');     
            
            var indicator = "Pdown";      

            if (resultsPDown.result1 != 0 && resultsPDown.result2 == 0) {
              resultsPDown.result2 =  getResults(mass_elements, emFactor_elements, distance_elements);
              $("#processCountPDown").replaceWith("<label id='processCountPDown> Processes: 2/2 </label>");

              // We add the second as parameter to the button click event. We also display the button
              $("#exportDatabasePDown").click(function(){exportTableToCSVEnvironmental(indicator, indicator+'_Process2.csv', 2, 3)});
              $("#exportDatabasePDown").css("display", "block");
            }
            if (resultsPDown.result1 == 0 && resultsPDown.result2 == 0) {
              resultsPDown.result1 =  getResults(mass_elements, emFactor_elements, distance_elements);
              $("#processCountPDown").replaceWith("<label id='processCountPDown'> Processes: 1/2 </label>");
              
              // We add the first process to the memory that will be exported later
              exportTableToCSVEnvironmental(indicator, indicator+'_Process1.csv', 1, 3);
            }            
            
          }

            
      });

      function getResults(mass_elements, emFactor_elements, distance_elements){
          $("#customTableErrorMessage").text("");

            // if($("input[name='indicator']").length == 1 && ($("#indicator").val() !== 'lifeExpectancy')){
            //   $("#customTableErrorMessage").text("Incorrect indicator option selected");
            //   return;
            // }

            selectedMethodId = "Environmental Analysis Method";           

            var masses = [];
            mass_elements.each(function () {
              masses.push($(this).val());
            });
            
            var emFactors = [];
            emFactor_elements.each(function () {              
              emFactors.push($(this).val());
            }); 
            
            var distances = [];
            if(distance_elements != null){
              distance_elements.each(function () {              
                distances.push($(this).val());
              });
            }

            return createResultsFromCustomTable(masses, emFactors, distances);          
      }

      // The event listener for the file uploads
      document.getElementById('txtFileUploadPup').addEventListener('change', upload, false);    
      document.getElementById('txtFileUploadPmid').addEventListener('change', upload, false);
      document.getElementById('txtFileUploadPdown').addEventListener('change', upload, false);      

      // TODO: Add the rest of the events here, pass the ID of the csv somehow (see this.id) and then convert the addNewProcessButton2
      // to have the appropriate button ID and to call the same fucntion based on the if statements

      // Method that checks that the browser supports the HTML5 File API
      function browserSupportFileUpload() {
        var isCompatible = false;
        if (window.File && window.FileReader && window.FileList && window.Blob) {
          isCompatible = true;
        }
        return isCompatible;
      }

      $(".addButton").click(function () {

        //var str ="<tr><td></td><td><input id='email' type='email' name='email' placeholder='Email'/></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td><td><input id='email' type='email' name='email' placeholder='Email' /></td></tr>'";

        // $('#customTable tbody').append(str);

        if($(this).attr('id') === 'addButtonPup'){
            addRows(customTablePup,0);
        }
        
        if($(this).attr('id') === 'addButtonPMid'){
            addRows(customTablePMid,0);
        } 

        if($(this).attr('id') === 'addButtonPDown'){
            addRows(customTablePDown,1);
        }       
      });

      function addRows(customTable,extra){
        if(extra === 1){
          customTable.dataTable().fnAddData([
            "",
            "<input id='mass' type='text' name='mass' placeholder='Mass' class='mass' />",
            "<input id='emissionFactor' type='text' name='emissionFactor' placeholder='Emission Factor Up' class='emissionFactor' />",
            "<input id='distance' type='text' name='distance' placeholder='Distance' class='distance' />"
          ]);

          return;
        }
        customTable.dataTable().fnAddData([
          "",
          "<input id='mass' type='text' name='mass' placeholder='Mass' class='mass' />",
          "<input id='emissionFactor' type='text' name='emissionFactor' placeholder='Emission Factor Up' class='emissionFactor' />"
        ]);
      }


      // Method that reads and processes the selected file
      function upload(evt) {        
        if (!browserSupportFileUpload()) {
          alert('The File APIs are not fully supported in this browser!');
        }
        else {          
          var data = null;
          var file = evt.target.files[0];
          var reader = new FileReader();
          reader.readAsText(file);

          var uploadId = this.id;

          reader.onload = function (event) {
            var csvData = event.target.result;
            data = $.csv.toArrays(csvData);                     
                      
            if(uploadId === 'txtFileUploadPup'){             
              // We clear the table from previous data
              if (tablePup != null) {
                tablePup.destroy();
                $('#CSVtablePUp').empty();              
              }
                                        
              if(checkCSVHeader(data,1) == false){
                console.log("Dataset must have three columns and have the header of 'Indicator,Mass,Emission Factor Up'");
              }        

              tablePup = populateTable(data, $('#CSVtablePUp'));                         
            }

            if(uploadId === 'txtFileUploadPmid'){
              if (tablePmid != null) {
                tablePmid.destroy();
                $('#CSVtablePmid').empty();              
              }
              
              if(checkCSVHeader(data,2) == false){
                console.log("Dataset must have three columns and have the header of 'Indicator,Mass,Emission Factor Mid'");
              } 
              
              tablePmid = populateTable(data,$('#CSVtablePmid'));
            }

            if(uploadId === 'txtFileUploadPdown'){
              if (tablePdown != null) {
                tablePdown.destroy();
                $('#CSVtablePdown').empty();              
              }

              if(checkCSVHeader(data,3) == false){
                console.log("Dataset must have four columns and have the header of 'Indicator,Mass,Emission Factor Down,Distance'");
              } 

              tablePdown = populateTable(data,$('#CSVtablePdown'));
            }            

          };
          reader.onerror = function () {
            alert('Unable to read ' + file.fileName);
          };
        }
      }

      $("#generateReport").click(async function () {

        // This fucntionality should be implemented using a Unit Testing framework
        //updateChart(chart, "Life Exprectancy", 1000000, 3000000);

        //Get the rest of the HTML elemensts here (name, scope, GWP etc.)

        // Get the canvas from the HTML
        var canvas = document.querySelector('#myChart');
        //creates image
        var canvasImg = canvas.toDataURL("image/png", 1.0);

        // We add all the info into one list in order to put them into the pdf   
        var list = [];
        // Add the info
        list.push($("#infoHeader").text());
        list.push($("#projectName").val());
        list.push($("#name").val());
        list.push($("#email").val());

        // Add the description
        list.push($("#scopeHeader").text());

        list.push($("textarea#phase1Text").val());
        
        // list.push($("#phase2Header").text());

        // TODO:This should be wrapped in an if()
        let LifeExpectancyTablePromise = new Promise ((resolve,reject) => { 
          window.scrollTo(0, 0);
          html2canvas($('#csv-displayLifeExpectancy')[0]).then(function (canvas) {
                var LifeExpectancyTableImg = canvas.toDataURL("image/png", 1.0);            
                resolve(LifeExpectancyTableImg);                   
              });                
        });


        // Add the selected equation
        list.push($("#methodHeader").text());
        // list.push($("label[for='"+selectedMethodId+"']").val());

        var equation_image = null;
        // Add the result
        if ($('input[id=environmentalMethod]:checked')) {
          // list.push($("label[for='environmentalMethod']").text());                          

          equation_image = document.querySelector('#indicator_image').getAttribute("src");                                      
        }

        list.push("Results:");

        list.push($("#Result1").text());
        list.push($("#Result2").text());

        list.push($("#phase4Header").text());

        // Remove the 'screenshot' of CSV table for now, there will be problem if we have table the spans in more than one 'table pages'
        // var LifeExpectancyTablePromiseResult = await LifeExpectancyTablePromise;
        // console.log("++++"+LifeExpectancyTablePromiseResult);        
        // createPDF(canvasImg, LifeExpectancyTablePromiseResult, list);

        createPDF(canvasImg, null, equation_image, list);
      });
    });



    function populateTable(dataSet, tableElement) {
      if (typeof (dataSet[0]) === 'undefined') {
        return null;
      }
      else {
        var columns = [];
        var data = [];
        $.each(dataSet, function (index, row) {

          // The first row of the csv data is going to be represent each column in our HTML table
          if (index == 0) {
            $.each(row, function (index, colData) {
              columns.push({ title: colData });
            });
          } // Then we just have the rest of the data
          else {
            data.push(row);
          }

        });


        // We assign the above data and columns and some attributes to display on the table.
        return tableElement.DataTable({
          data: data,
          columns: columns,
          select: {
            style: 'single',
            items: 'row'
          },
          // dom: 'Bfrtip',
          // buttons: [
          //     {
          //         text: 'Get selected data',
          //         action: function () {
          //             // var count = table.rows( { selected: true } ).count();

          //             // events.prepend( '<div>'+count+' row(s) selected</div>' );
          //             // console.log(table.rows({seleted: true}).data()[0]);
          //             var data  = table.rows({seleted: true}).data()[0];

          //             var result = data[0]*data[1]+data[2]*data[3];
          //             console.log(data);

          //             results.append($( "<i>"+result+"</i>"));
          //         }
          //     }
          // ]        
        });
      }


    }

  </script>

  <!-- The library for the charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

  <!--LCA Tool ends-->